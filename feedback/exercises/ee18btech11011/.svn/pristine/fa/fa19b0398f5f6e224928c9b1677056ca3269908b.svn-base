The circuit in Fig. \ref{fig:ee18btech11011_original_circuit} utilizes a voltage amplifier with gain $\mu$ in a shunt-shunt feedback topology with the feedback network composed of resistor $R_{F}$.In order to be able to use the feedback equations you should first convert the signal source to it's Norton Representation.
\begin{enumerate}
    \item If the loop gain is very large, what approximate closed loop voltage gain $V_{o}/V_{s}$ is realized? If $R_{s}$ = 1k$\ohm$, give the value of $R_{F}$ that will result in $V_{o}/V_{s}$ $\simeq$ -10V/V.
    \item If the amplifier $\mu$ has a dc gain of $10^{3}$ V/V, an input
    resistance $R_{i d}$ = 100k$\ohm$, and an output resistance $r_{o}$ = 1k$\ohm$
    , find the actual $V_{o}/V_{s}$ realized. Also find $R_{i n}$ and $R_{o u t}$.
    \item If the amplifier $\mu$ has an upper 3-dB frequency of 1 kHz and a uniform -20-dB/decade gain rolloff, what is the 3-dB frequency of the gain $\mid V_{o}/V_{s} \mid$.
\end{enumerate}

\begin{enumerate}[label=\arabic*.,ref=\theenumi]
\numberwithin{equation}{enumi}
\item Fig. \ref{fig:ee18btech11011_original_circuit} shows the original circuit. Draw the Norton Representation, A-Circuit and H-Circuit.
\\
\solution See Fig. \ref{fig:ee18btech11011_Norton_Representation} for the Norton Representation, Fig. \ref{fig:ee18btech11011_A1_circuit} and Fig. \ref{fig:ee18btech11011_A2_circuit} for A-Circuit and Fig. \ref{fig:ee18btech11011_beta_circuit} for the H-Circuit.  

\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/original_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_original_circuit}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/Shunt_Shunt_Amplifier_Block_Diagram.tex}}
	\end{center}
\caption{Shunt Shunt Amplifier Block Diagram}
\label{fig:Shunt_Shunt_Amplifier_Block_Diagram}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/Norton_Representation.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_Norton_Representation}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/A1_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_A1_circuit}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/A2_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_A2_circuit}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/beta_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_beta_circuit}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/Block_Diagram.tex}}
	\end{center}
\caption{Block Diagram}
\label{fig:Block Diagram}
\end{figure}
%
\item Refer Table \ref{table:ee18btech11011_Parameters_table} for the parameters.
%
\begin{table}[!ht]
\centering
\input{./tables/ee18btech11011/Parameters_Table.tex}
\caption{}
\label{table:ee18btech11011_Parameters_table}
\end{table}
%
\item Write all the feedback equations based on all the Figs. using KCL/KVL.
\\
\solution The equations are as follows:
%
\begin{align}
\label{eq:ee18btech11011_Closed_loop_Gain1}
T &= \frac{V_{o}}{I_{s}} = \frac{G}{1+GH}\\
\label{eq:ee18btech11011_Feedback_Factor}
H &= \frac{I_{f}}{V_{o}} = -\frac{1}{R_F}\\
\label{eq:ee18btech11011_I_i}
I_{i} &= I_{s} - I_{f} = \frac{I_{s}}{1+GH}\\
\label{eq:ee18btech11011_R_if}
R_{i f} &= \frac{V_{i}}{I_{s}} = \frac{V_{i}}{(1+GH)I_{i}} =\frac{R_{i}}{1+GH}\\
\label{eq:ee18btech11011_R_of}
R_{o f} &= \frac{R_{o}}{1+GH}\\
\label{eq:ee18btech11011_R_in_and_R_out}
R_{i n} &= \frac{1}{\frac{1}{R_{i f}} - \frac{1}{R_{s}}} , R_{o u t} = \frac{1}{\frac{1}{R_{o f}} - \frac{1}{R_{L}}}
\end{align}
%
\item If the loop gain is very large, what approximate closed-loop voltage gain $V_{o}/V_{s}$ is realized?Also if $R_{s}$ = 1 k$\ohm$ , give the value of $R_{F}$ that will result in $V_{o}/V_{s}$ $\simeq$ -10 V/V.
\\
\solution If the loop gain GH is very large then the closed loop gain is,

\begin{align}
T = \frac{V_{o}}{I_{s}} = \frac{G}{1+GH}\\
\because GH >> 1 \implies T \approx \frac{1}{H}
\label{eq:ee18btech11011_Closed_Loop_Gain2}
\end{align}

From equation \ref{eq:ee18btech11011_Feedback_Factor} and \ref{eq:ee18btech11011_Closed_Loop_Gain2} we get,

\begin{align}
T &\approx -R_{F}\\
\implies \frac{V_{o}R_s}{V_{s}} &\approx -R_{F}\\
\implies R_{F} &= 10k\ohm
\end{align}
\item If the amplifier $\mu$ has a dc gain of $10^3$ V/V, an input resistance $R_{i d}$ = 100 k$\ohm$ , and an output resistance $r_{o}$ = 1 k$\ohm$ , find the actual $V_{o}/V_{s}$ realized. Also find $R_{i n}$ and $R_{o u t}$.
\\
\solution To find $V_{o}/V_{s}$, $R_{i n}$ and $R_{o u t}$ first find the other necessary parameters.
From Fig. \ref{fig:ee18btech11011_A1_circuit} we get,

\begin{align}
R_{i} &= R_{i d}\|R_{F}\|R_{s}\\
\label{ee18btech11011_R_i}
R_{i} &= 100k\|10k\|1k = 0.90k\ohm\\
\label{eq:ee18btech11011_V_id}
V_{i d} &= I_{i}R_{i}
\end{align}

From Fig. \ref{fig:ee18btech11011_A2_circuit} we get,

\begin{align}
R_{o} &= r_{o}\|R_{F}\\
\label{ee18btech11011_R_o}
\implies R_{o} &= 1k\|10k = 0.91k\ohm\\
\label{eq:ee18btech11011_V_o}
V_{o} &= -\mu V_{i d}\frac{R_{F}}{r_{o} + R_{F}}
\end{align}

From equation \ref{eq:ee18btech11011_V_id} and \ref{eq:ee18btech11011_V_o} we get the open-loop gain as,

\begin{align}
G &= \frac{V_{o}}{I_{i}} = -\mu R_{i}\frac{R_{F}}{r_{o} + R_{F}}
\\
\label{ee18btech11011_Open_loop_Gain}
\implies G &= -(1000)(0.90)\frac{10}{11} = -819.00k\ohm
\end{align}

From equation \ref{eq:ee18btech11011_Feedback_Factor} and \ref{ee18btech11011_Open_loop_Gain} we get closed loop gain T as,

\begin{align}
T &= \frac{G}{1+GH} = \frac{-819}{82.9} = -9.88k\ohm
\end{align}

From equation \ref{eq:ee18btech11011_Closed_loop_Gain1} we know,
\begin{align}
T &= \frac{V_{o}}{I_{s}}
\\
\implies T &= \frac{V_{o}R_{s}}{V_{s}}
\\
\implies \frac{V_{o}}{V_{s}} &= \frac{T}{R_{s}} 
\\
\implies \frac{V_{o}}{V_{s}} &= \frac{-9.88}{1} = -9.88V/V
\label{eq:ee18btech11011_Value_of_Vo/Vs}
\end{align}
From equation \ref{eq:ee18btech11011_R_if} and \ref{eq:ee18btech11011_R_in_and_R_out} we know,

\begin{align}
R_{i f} &= \frac{R_{i}}{1+GH} = \frac{0.90}{82.9}
\\
\implies R_{i f} &= 10.87\ohm
\\
R_{i n} &= \frac{1}{\frac{1}{R_{i f}} - \frac{1}{R_{s}}}
\\
\implies R_{i n} &= \frac{1}{\frac{1}{10.87} - \frac{1}{1000}} = 10.99\ohm
\end{align}

Because $R_{L}$ is not there in the circuit so we take it's value as $\infty$, so from equation \ref{eq:ee18btech11011_R_of} and \ref{eq:ee18btech11011_R_in_and_R_out} we know,

\begin{align}
R_{o f} &= \frac{R_{o}}{1+GH} = \frac{0.91}{82.9}
\\
\implies R_{o f} &= 10.97\ohm
\\
R_{o u t} &= \frac{1}{\frac{1}{R_{o f}} - \frac{1}{R_{L}}}
\\
\implies R_{o u t} &= \frac{1}{\frac{1}{10.97} - \frac{1}{\infty}} = 10.97\ohm
\end{align}

Verify the above calculations using the following Python code.
\begin{lstlisting}
codes/ee18btech11011/ee18btech11011_cal.ipynb
\end{lstlisting}

\item If the amplifier $\mu$ has an upper 3-dB frequency of 1 kHz and a uniform -20-dB/decade gain rolloff, what is the 3-dB frequency of the gain $\mid V_{o}/V_{s}\mid$.
\\
\solution To find the 3-dB frequency i.e., $\omega_{3 d B}$ we need to look at the Fig.\ref{fig:ee18btech11011_Inverting_configuration}.
\begin{figure}[!ht]
	\begin{center}
			\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11011/Inverting_configuration.tex}}
	\end{center}
\caption{}
\label{fig:ee18btech11011_Inverting_configuration}
\end{figure}

The open loop gain G is given as follows in terms of frequency:
\begin{align}
    G &= \frac{\mu}{1 + \frac{jf}{f_{c}}}
\end{align}

From Fig.\ref{fig:ee18btech11011_Inverting_configuration} we can say that:
\begin{align}
    V_{i n} &= V_{s} - V_{f}
    \label{eq:ee18btech11011_Vin_Vs_Vf_relation}
    \\
    V_{o} &= -GV_{i n}
    \label{eq:ee18btech11011_Vin_Vo_relation}
    \\
    \frac{V_{f}}{R_{s}} &= \frac{V_{i n} - V_{o}}{R_{F}}
    \label{eq:ee18btech11011_Vf_Vin_Vo_relation}
\end{align}

From equation \ref{eq:ee18btech11011_Vin_Vo_relation} and \ref{eq:ee18btech11011_Vf_Vin_Vo_relation} we get:
\begin{align}
    \frac{V_{f}}{R_{s}} &= \frac{-\frac{V_{o}}{G} - V_{o}}{R_{F}}
    \\
    \implies \frac{V_{f}}{V_{o}} &= -\frac{(1 + G)}{G}\frac{(R_{s})}{(R_{F})} = -H
    \label{eq:ee18btech11011_Transfer_Function}
    \\
    \because G>>1 \implies H &= \frac{R_{s}}{R_{F}}
\end{align}

Now from equation \ref{eq:ee18btech11011_Vin_Vs_Vf_relation}, \ref{eq:ee18btech11011_Vin_Vo_relation} and \ref{eq:ee18btech11011_Transfer_Function} we get:
\begin{align}
    -\frac{V_{o}}{G} &= V_{s} + HV_{o}
    \\
    \implies \frac{V_{o}}{V_{s}} &= -\frac{G}{1 + GH}
\end{align}

Now, for "f" to be 3-dB frequency given condition should be match i.e.,:
\begin{align}
    \mid\frac{V_{o}}{V_{s}}\mid &= \frac{1}{\sqrt{2}}
    \\
    \implies \mid-\frac{G}{1 + GH}\mid &= \frac{1}{\sqrt{2}}
    \\
    \implies \frac{\frac{\mu}{1 + \frac{jf}{f_{c}}}}{1 + \frac{(R_{s})}{(R_{F})}\frac{\mu}{1 + \frac{jf}{f_{c}}}} &= \frac{1}{\sqrt{2}}
\end{align}
 
\begin{table}[!ht]
\centering
\input{./tables/ee18btech11011/Values_Table_for_Part_C.tex}
\caption{}
\label{table: Values_Table}
\end{table}

Now putting the appropriate values as given in Table \ref{table: Values_Table} we get:
\begin{align}
     \frac{\frac{1000}{1 + \frac{jf}{1000}}}{1 + \frac{(1)}{(10)}\frac{1000}{1 + \frac{jf}{1000}}} &= \frac{1}{\sqrt{2}}
\\
     \frac{f^2}{10^{1 2}} + \frac{101^2}{10^6} &= 2
\\
     f \approx 1.41MHz
\end{align}
\item Using ngspice verify the Closed-Loop Transfer function or $V_{o}/V_{s}$.

\solution From \ref{eq:ee18btech11011_Value_of_Vo/Vs} we know that:

\begin{align}
    \frac{V_{o}}{V_{s}} &= -9.88V/V
\end{align}

So, to verify this use the following spice file.

\begin{lstlisting}
spice/ee18btech11011/ee18btech11011.net
\end{lstlisting}

and finally to get the result use the following python code.

\begin{lstlisting}
spice/ee18btech11011/ee18btech11011_spice.py
\end{lstlisting}

Result:
\begin{lstlisting}
figs/ee18btech11011/ee18btech11011_spice_result.eps
\end{lstlisting}
\begin{lstlisting}
figs/ee18btech11011/ee18btech11011_spice_result.pdf
\end{lstlisting}

Following are the instructions to run the spice file.
\begin{lstlisting}
spice/ee18btech11011/README.md
\end{lstlisting}


\end{enumerate}
