%--------------------------------------------------------%

The feedback current amplifier in Fig. \ref{fig:ep18btech11016_circuit} utilizes an op amp with an input differential resistance $R_{id}$, an open-loop gain $\mu$ , and an output resistance $r_o$. The output current $I_o$ that is delivered to the load resistance $R_L$ is sensed by the feedback network composed of the two resistances $R_M$ and $R_F$ and a fraction $I_f$, is fed back to the amplifier input node. Find expressions for $G = \cfrac{I_o}{I_i}$, $H = \cfrac{I_f}{I_o}$ and $T = \cfrac{I_o}{I_s}$, assuming that the feedback causes the voltage at the input node to be near ground. If the loop gain is large, what does the closed-loop current gain become? State precisely the condition under which this is obtained. For $\mu$ = $10^4$, $R_{id}$ = 1 M$\Omega$, $r_o$ = 100 $\Omega$, $R_L$ = 10 k$\Omega$ , $R_M$ = 100 $\Omega$ , and $R_F$ = 10 k$\Omega$, find G, H, and T.

%--------------------------------------------------------%

\begin{enumerate}[label=\arabic*.,ref=\theenumi]
\numberwithin{equation}{enumi}

%--------------------------------------------------------%

\item Fig. \ref{fig:ep18btech11016_circuit} shows a feedback current amplifier. Draw the equivalent control system.
\\
\solution See fig \ref{fig:ep18btech11016_block}
\\

\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_circuit}
\end{figure}
%
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_block_diagram.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_block}
\end{figure}
\renewcommand{\thefigure}{\theenumi}

%--------------------------------------------------------%

\item Refer table \ref{table:ep18btech11016_comps} for the parameters and draw the small signal equivalent model of the fig \ref{fig:ep18btech11016_circuit}
\\
\solution See fig \ref{fig:ep18btech11016_equi}
\\

\begin{table}[!ht]
    \centering
    \input{./tables/ep18btech11016/ep18btech11016_1.tex}
    \caption{}
    \label{table:ep18btech11016_comps}
\end{table}

\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_equi_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_equi}
\end{figure}

%--------------------------------------------------------%

\item Given G (open-loop gain) as
\begin{align}
     G = \cfrac{I_o}{I_i}
\end{align}
Find G by considering the general open loop block diagram as shown in fig. \ref{fig:ep18btech11016_open} and fig. \ref{fig:ep18btech11016_equi}
\\
\solution Clearly from fig. \ref{fig:ep18btech11016_equi}, we can see that,
\begin{align}
    G = \cfrac{I_o}{I_i} = \mu
    \label{eq:ep18btech11016_ol_gain}
\end{align}

\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_open.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_open}
\end{figure}

%--------------------------------------------------------%

\item Draw the block diagram and equivalent circuit for H (feedback factor).
\\
\solution Refer fig. \ref{fig:ep18btech11016_feed} and \ref{fig:ep18btech11016_feed_circuit}

\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_feed.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_feed}
\end{figure}

\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/ep18btech11016/ep18btech11016_feed_circuit.tex}}
	\end{center}
\caption{}
\label{fig:ep18btech11016_feed_circuit}
\end{figure}
\renewcommand{\thefigure}{\theenumi}

%--------------------------------------------------------%

\item Considering the feedback circuit as shown in fig. \ref{fig:ep18btech11016_feed_circuit}. Find R11 and R22.
\\
\solution The value of $R_{11}$ is obtained by  looking from port 1 (left) while it's port 2 is open-circuited and the value of $R_{22}$ is obtained by looking into port 2 (right) while it's port 1 is short-circuited.
\begin{align}
    R_{11} = R_F + R_M\\
    R_{22} = R_F \parallel R_M
\end{align}

%--------------------------------------------------------%

\item Given H as 
\begin{align}
    H = \cfrac{I_f}{I_o}
\end{align}
Find H from fig. \ref{fig:ep18btech11016_feed_circuit}.
\\
\solution Using current division,
\begin{align}
    \cfrac{I_f}{I_o} = -\cfrac{R_M}{R_F + R_M}
\end{align}
\begin{align}
    \implies H = \cfrac{1}{1 + \cfrac{R_F}{R_M}}
    \label{eq:ep18btech11016_feed_gain}
\end{align}

%--------------------------------------------------------%

\item Given T (closed-loop gain) as
\begin{align}
    T = \cfrac{I_o}{I_s}
\end{align}
Find T.
\\
\solution We know, 
\begin{align}
    T = \cfrac{G}{1 + G H}
\end{align}

Therefore, from eq. \ref{eq:ep18btech11016_ol_gain} and \ref{eq:ep18btech11016_feed_gain}, we get,
\begin{align}
    T = \cfrac{\mu}{1 + \cfrac{\mu}{1 + \cfrac{R_F}{R_M}}}
    \label{eq:ep18btech11016_cl_gain}
\end{align}

%--------------------------------------------------------%

\item What will be closed-loop gain(T) if $\mu \to \infty$
\\
\solution From eq. \ref{eq:ep18btech11016_cl_gain} we get,

\begin{align}
    T = \cfrac{\mu}{1 + \cfrac{\mu}{1 + \cfrac{R_F}{R_M}}}\\
    T = \cfrac{1}{\cfrac{1}{\mu} + \cfrac{1}{1 + \cfrac{R_F}{R_M}}}
\end{align}

Applying the limit, we get,
\begin{align}
    \implies T = 1 + \cfrac{R_F}{R_M}
\end{align}

%--------------------------------------------------------%

\item Refer table \ref{table:ep18btech11016_values} and find G, H and T
\\
\solution Using eqs. \ref{eq:ep18btech11016_ol_gain}, \ref{eq:ep18btech11016_feed_gain} and \ref{eq:ep18btech11016_cl_gain}

We get,
\begin{align}
    G = \mu = 10^4\\
    H = \cfrac{ 1 }{1 + \cfrac{R_F}{R_M}} = 9.9 \times 10^{-3}\\
    T = \cfrac{\mu}{1 + \cfrac{\mu}{1 + \cfrac{R_F}{R_M}}} = 100
\end{align}

\begin{table}[!ht]
    \centering
    \input{./tables/ep18btech11016/ep18btech11016_2.tex}
    \caption{}
    \label{table:ep18btech11016_values}
\end{table}

%--------------------------------------------------------%

\item Tabulate your results.
\\
\solution Refer table \ref{table:ep18btech11016_final},

\begin{table}[!ht]
    \centering
    \input{./tables/ep18btech11016/ep18btech11016_3.tex}
    \caption{}
    \label{table:ep18btech11016_final}
\end{table}

%--------------------------------------------------------%

\item Simulate the circuit \ref{fig:ep18btech11016_circuit} using spice simulators and plot the generated output of the gains using python script
\\
\solution Refer fig. \ref{fig:ep18btech11016_feed_gain} and \ref{fig:ep18btech11016_cl_gin} for the plots.

\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
    \centering
    \includegraphics[width=\columnwidth]{./figs/ep18btech11016/ep18btech11016_feed_gain.eps}
\caption{}
\label{fig:ep18btech11016_feed_gain}
\end{figure}

\begin{figure}[!ht]
	\centering
    \includegraphics[width=\columnwidth]{./figs/ep18btech11016/ep18btech11016_cl_gain.eps}
\caption{}
\label{fig:ep18btech11016_cl_gin}
\end{figure}
\renewcommand{\thefigure}{\theenumi}

Find the netlist of the simulated circuit here:
\begin{lstlisting}
    codes/ep18btech11016/spice/ep18btech11016.net
\end{lstlisting}

Python code used for generating the output:
\begin{lstlisting}
    codes/ep18betch11016/spice/ep18btech11016.py
\end{lstlisting}

%--------------------------------------------------------%

\end{enumerate}
